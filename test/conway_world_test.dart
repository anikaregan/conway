import 'package:conway/conway.dart';
import 'package:test/test.dart';

void main() {
  test('a single lonely cell dies', () {
    var w = ConwayWorld.fromString('''
.....
.....
..#..
.....
.....
''');

    // Verify it doesn't survive one step.
    w.takeStep();
    expect(w.toString(), equals('''
.....
.....
.....
.....
.....
'''));

    // Verify it stays dead over 100 cycles.  Sigh.
    w.takeSteps(100);
    expect(w.toString(), equals('''
.....
.....
.....
.....
.....
'''));
  });

  test('blinker', () {
    var w = ConwayWorld.blinker;
    expect(w.toString(), equals('''
.....
..#..
..#..
..#..
.....
'''));

    w.takeStep();
    expect(w.toString(), equals('''
.....
.....
.###.
.....
.....
'''));

    // Period is two.
    w.takeStep();
    expect(w, equals(ConwayWorld.blinker));

    // Do one more period.
    w.takeSteps(2);
    expect(w, equals(ConwayWorld.blinker));
  });

  test('pentaDecathlon', () {
    var w = ConwayWorld.pentaDecathlon;
    expect(w.toString(), equals('''
...........
...........
...........
....###....
...#...#...
...#...#...
....###....
...........
...........
...........
...........
....###....
...#...#...
...#...#...
....###....
...........
...........
...........
'''));

    w.takeStep();
    expect(w.toString(), equals('''
...........
...........
.....#.....
....###....
...#.#.#...
...#.#.#...
....###....
.....#.....
...........
...........
.....#.....
....###....
...#.#.#...
...#.#.#...
....###....
.....#.....
...........
...........
'''));

    w.takeStep();
    expect(w.toString(), equals('''
...........
...........
....###....
...........
...#...#...
...#...#...
...........
....###....
...........
...........
....###....
...........
...#...#...
...#...#...
...........
....###....
...........
...........
'''));

    // Period is 15; already took 2 steps, take 13 more.
    w.takeSteps(13);
    expect(w, equals(ConwayWorld.pentaDecathlon));
  });

  test('lightwieghtSpaceship', () {
    var w = ConwayWorld.lightweightSpaceship.padRight(30);
    expect(w.toString(), equals('''
.....................................
.#..#................................
.....#...............................
.#...#...............................
..####...............................
.....................................
'''));

    // Period is four.
    w.takeSteps(4);
    expect(w.toString(), equals('''
.....................................
...#..#..............................
.......#.............................
...#...#.............................
....####.............................
.....................................
'''));

    w.takeSteps(4);
    expect(w.toString(), equals('''
.....................................
.....#..#............................
.........#...........................
.....#...#...........................
......####...........................
.....................................
'''));

    w.takeSteps(8 * 4);
    expect(w.toString(), equals('''
.....................................
.....................#..#............
.........................#...........
.....................#...#...........
......................####...........
.....................................
'''));

    // Take enough periods to fly past world boundary.
    w.takeSteps(26 * 4);
    expect(w.toString(), equals('''
.....................................
..#.................................#
...#.................................
...#................................#
####.................................
.....................................
'''));
  });

  test('glider', () {
    var w = ConwayWorld.glider.padBottom(1).padTop(1).padLeft(1).padRight(1);
    expect(w.toString(), equals('''
.........
.........
....#....
.....#...
...###...
.........
.........
'''));

    // Period is four.
    w.takeSteps(4);
    expect(w.toString(), equals('''
.........
.........
.........
.....#...
......#..
....###..
.........
'''));

    w.takeSteps(4);
    expect(w.toString(), equals('''
.........
.........
.........
.........
......#..
.......#.
.....###.
'''));

    // Take four periods to fly past world boundary.
    w.takeSteps(4 * 4);
    expect(w.toString(), equals('''
.........
.#.......
..#......
###......
.........
.........
.........
'''));
  });

  // Show how the gun works.
  test('gliderGun', () {
    var w = ConwayWorld.gosperGliderGun
        .padLeft(2)
        .padTop(2)
        .padBottom(46)
        .padRight(33);
    w.takeSteps(200);
    expect(w.toString(), equals('''
.........................................................................
.........................................................................
.........................................................................
.............................##..........................................
............................#...#........................................
............##.............#.....#...##..................................
............##.............#...#.##..##..................................
...##...#......##..........#.....#.......................................
...#.#...#.....###..........#...#........................................
....#####......##............##..........................................
.....###....##.........#.#...............................................
............##..........##...............................................
........................#................................................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
...............................#.........................................
................................##.......................................
...............................##........................................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
......................................#.#................................
.......................................##................................
.......................................#.................................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
..............................................#..........................
...............................................##........................
..............................................##.........................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
.....................................................#.#.................
......................................................##.................
......................................................#..................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
.............................................................#...........
..............................................................##.........
.............................................................##..........
.........................................................................
.........................................................................
.........................................................................
.........................................................................
.........................................................................
....................................................................#.#..
.....................................................................##..
.....................................................................#...
.........................................................................
'''));
  });

  // Shoot two guns at each other.
  test('gunFight', () {
    var w = ConwayWorld.gunFight();
    w.takeSteps(150);
    expect(w.toString(), equals('''
......................................................................
......................................................................
......................................................................
...........................#..........................................
.........................#.#..........................................
............#..........##............##...............................
...........#.#.........##............##...............................
...##..................##.............................................
...##......#..#..........#.#..........................................
............#..............#..........................................
.............###......................................................
......................................................................
..........................#...........................................
...........................##.........................................
..........................##..........................................
......................................................................
....................#.................................................
...................##.................................................
...................#.#................................................
......................................................................
.................................#.#..................................
..................................##..................................
..................................#...................................
......................................................................
...........................##.........................................
..........................##..........................................
............................#.........................................
.........................................#............................
..........................................##..........................
.........................................##...........................
......................................................................
...................................#..................................
..................................##..................................
..................................#.#.................................
......................................................................
................................................#.#...................
.................................................##...................
.................................................#....................
......................................................................
..........................................##..........................
.........................................##...........................
...........................................#..........................
......................................................................
......................................................###.............
..........................................#..............#............
..........................................#.#..........#..#......##...
.............................................##..................##...
...............................##............##.........#.#...........
...............................##............##..........#............
..........................................#.#.........................
..........................................#...........................
......................................................................
......................................................................
......................................................................
'''));
  });
}
